#lang rhombus

import:
  rhombus/meta open

fun is_digit(c):
  c >= Char"0" && c <= Char"9"

fun count_hashes(line):
  def mutable count = 0
  for (c in line):
    when c == Char"#"
    | count := count + 1
  count

fun find_char_index(s, target_char):
  def mutable result = -1
  for (i in 0..s.length()):
    when s[i] == target_char && result == -1
    | result := i
  result

fun main():
  def lines = filesystem.read_lines("input.txt")

  def mutable shapes = Map{}
  def mutable region_lines = []
  def mutable current_shape_id = -1
  def mutable current_cell_count = 0

  for (line in lines):
    def trimmed = line.trim()
    when trimmed.length() > 0
    | def first_char = trimmed[0]
      def is_shape_line = is_digit(first_char) && trimmed.contains(":") && !trimmed.contains("x")
      def is_region_line = trimmed.contains("x") && trimmed.contains(":")
      def is_pattern_line = current_shape_id >= 0 && (trimmed.contains("#") || trimmed.contains("."))

      if is_shape_line
      | when current_shape_id >= 0
        | shapes := shapes ++ {current_shape_id: current_cell_count}
        def parts = trimmed.split(":")
        current_shape_id := parts[0].to_int()
        current_cell_count := 0
      | if is_region_line
        | when current_shape_id >= 0
          | shapes := shapes ++ {current_shape_id: current_cell_count}
            current_shape_id := -1
            current_cell_count := 0
          region_lines := region_lines ++ [trimmed]
        | when is_pattern_line
          | current_cell_count := current_cell_count + count_hashes(trimmed)

  when current_shape_id >= 0
  | shapes := shapes ++ {current_shape_id: current_cell_count}

  def mutable part1 = 0

  for (region_line in region_lines):
    def parts = region_line.split(":")
    def size_part = parts[0]
    def counts_part = parts[1].trim()

    def size_parts = size_part.split("x")
    def width = size_parts[0].to_int()
    def height = size_parts[1].to_int()

    def count_strs = counts_part.split(" ")
    def mutable total_cells_needed = 0

    for (i in 0..count_strs.length()):
      def count_str = count_strs[i]
      when count_str.length() > 0
      | def count = count_str.to_int()
        def shape_cells:
          if shapes.has_key(i)
          | shapes[i]
          | 0
        total_cells_needed := total_cells_needed + count * shape_cells

    def grid_area = width * height
    when total_cells_needed <= grid_area
    | part1 := part1 + 1

  println("Day 12 Part 1: " ++ to_string(part1))
  println("Day 12 Part 2: 0")

main()
