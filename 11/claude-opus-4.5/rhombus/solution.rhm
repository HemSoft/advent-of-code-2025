#lang rhombus

fun main():
  def lines = filesystem.read_lines("input.txt")

  def mutable graph = {}

  for (line in lines):
    when line.length() > 0
    | def parts = line.split(":")
      def source = parts[0].trim()
      def dest_str = parts[1].trim()
      def destinations = dest_str.split(" ")
      graph := graph ++ {source: destinations}

  def mutable memo1 = {}

  fun count_paths(current, target):
    if current == target
    | 1
    | if memo1.has_key(current)
      | memo1[current]
      | if graph.has_key(current)
        | def neighbors = graph[current]
          def mutable count = 0
          for (neighbor in neighbors):
            count := count + count_paths(neighbor, target)
          memo1 := memo1 ++ {current: count}
          count
        | 0

  def mutable memo2 = {}

  fun count_paths_with_required(current, target, visited_dac, visited_fft):
    def new_visited_dac = visited_dac || current == "dac"
    def new_visited_fft = visited_fft || current == "fft"
    if current == target
    | if new_visited_dac && new_visited_fft
      | 1
      | 0
    | def key = [current, new_visited_dac, new_visited_fft]
      if memo2.has_key(key)
      | memo2[key]
      | if graph.has_key(current)
        | def neighbors = graph[current]
          def mutable count = 0
          for (neighbor in neighbors):
            count := count + count_paths_with_required(neighbor, target, new_visited_dac, new_visited_fft)
          memo2 := memo2 ++ {key: count}
          count
        | 0

  // Part 1
  def part1 = count_paths("you", "out")
  println("Day 11 Part 1: " ++ to_string(part1))

  // Part 2
  def part2 = count_paths_with_required("svr", "out", #false, #false)
  println("Day 11 Part 2: " ++ to_string(part2))

main()
